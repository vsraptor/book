
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Spatial Pooler/Mapper &#8212; My book</title>
    
  <link href="../../_static/css/theme.css" rel="stylesheet" />
  <link href="../../_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/basic.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../../_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/togglebutton.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="TM design" href="tm_design.html" />
    <link rel="prev" title="Encoders" href="encoders.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="container-xl">

  <div id="navbar-start">
    
    

<a class="navbar-brand" href="../../intro.html">
  <img src="../../_static/logo.png" class="logo" alt="logo">
</a>


    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../markdown.html">
  Markdown Files
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../notebooks.html">
  Content with notebooks
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../multi-regex/multi-regex.html">
  Multi regex
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../threensition/threensition.html">
  Three-nsitions
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../misc/piped_wordnet.html">
  Wordnet pipes
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../misc/keyvi-index.html">
  Keyvi index
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference external nav-link" href="https://gist.github.com/vsraptor">
  Random code gists
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="whatis.html">
  <strong>
   What is iHTM ?
  </strong>
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="sdp_explained.html">
  SDP:SDR vs SDP:BSC
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="isdp.html">
  iSDP : indexed Semantic Distributed Pointers aka Symbols
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="misc.html">
  MED
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="lexicon.html">
  Lexicon
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="sequence_learning.html">
  <strong>
   Sequence learning
  </strong>
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="theory.html">
  <strong>
   HTM Theory : short intro
  </strong>
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="encoders.html">
  <strong>
   Encoders
  </strong>
 </a>
</li>

<li class="toctree-l1 current active nav-item">
 <a class="current reference internal nav-link" href="#">
  <strong>
   Spatial Pooler/Mapper
  </strong>
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="tm_design.html">
  <strong>
   TM design
  </strong>
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="segmented_memory.html">
  <strong>
   Segmented memory (Classifier)
  </strong>
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="temporal_memory.html">
  Temporal memory
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../bi/What_is_Bi.html">
  What is Bi
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../bi/Bi_framework.html">
  Bi Framework
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../bi/Bi_language.html">
  Language
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../bi/Integration.html">
  Integration
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../bi/More_CUPS.html">
  More CUPS
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../bi/More_Operations.html">
  More OPS
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../bbhtm/bbHTM.html">
  Bare bones HTM
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../bbhtm/TM_test.html">
  TEST wrapper
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../bbhtm/bmap2D.html">
  Bitmap 2D
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../bbhtm/spatial_mapper.html">
  Spatial mapper
 </a>
</li>

    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
      </ul>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
            
            <!-- Only show if we have sidebars configured, else just a small margin  -->
            <div class="col-12 col-md-3 bd-sidebar"><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    
  </div>
</nav>
            </div>
            
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
            
              
              <div class="toc-item">
                
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#pretrain">
   Pretrain
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#lexicon-sm-encode-decode">
   Lexicon + SM.encode/decode
  </a>
 </li>
</ul>

</nav>
              </div>
              
              <div class="toc-item">
                
              </div>
              
            
          </div>
          

          
          
            
          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <div class="section" id="spatial-pooler-mapper">
<h1><strong>Spatial Pooler/Mapper</strong><a class="headerlink" href="#spatial-pooler-mapper" title="Permalink to this headline">¶</a></h1>
<p>I already mentioned what is the purpose of the Spatial Pooler (I call mine <strong>Spatial Mapper</strong>).
The question is how to implement it.</p>
<p>The implementation is a mix of HTM theory and Self Organized Map (SOM).</p>
<p>The core is a numpy 2D array with values in the range between [0,1].
The X axis has the size of the input SDP and the Y axis has the size of the output.</p>
<p>You can think of a column as a pseudo-X-neuron where every row is a connection to the input Y-neuron.
Percentage (by default 85%) of the column is randomly filled with numbers between 0 and 1.</p>
<p>When SDP arrives at X-axis it is converted to 01-mask, the mask is multiplied across the rows and then the columns are summed /zero-rows are zeroed, one-rows are kept/. The columns (def:2%) with the higher sum (winner takes all) are chosen for update.</p>
<p><em>We also filter the values below a threshold (def:0.1) and exclude them from the sum.</em></p>
<p>Now that we have the Y-winner cols we apply the update to 1 and 0 rows according to the following two formulas :</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span> ones += learn_rate * ( 1 - ones)
 zeros += unlearn_rate * ( 0 - zeros)
</pre></div>
</div>
<p>this forces the updated values to move on a <strong>S-curve</strong> between 0 and 1 as they are updated.</p>
<blockquote>
<div><p>the unlearn rate has to be much smaller than the learn rate</p>
</div></blockquote>
<p>So far so good, but we have a small problem, the algorithm so far will tend to use the most popular columns and not use the rest. To fix that we <strong>boost</strong> of the rarely used columns.</p>
<p>During the learning phase we count every use of a column and based on this create a score which becomes smaller for highly used columns and vs versa. This score then is used in the calculating the WTA-sum.</p>
<p>Here is how the sum operation looks :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">olap</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="nb">input</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">weight_matrix</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">permanence_thresh</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="k">if</span> <span class="n">boost</span> <span class="p">:</span> <span class="n">olap</span> <span class="o">=</span> <span class="p">(</span><span class="n">olap</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">boost</span><span class="p">)</span>
</pre></div>
</div>
<p>So let see it in action :</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s1">&#39;../../ilib&#39;</span><span class="p">,</span> <span class="s1">&#39;../../ilib/encoders&#39;</span><span class="p">,</span> <span class="s1">&#39;../../ilib/modules&#39;</span><span class="p">])</span>
<span class="kn">from</span> <span class="nn">scalar_encoder</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">category_encoder</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">ispatial_mapper</span> <span class="kn">import</span> <span class="o">*</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CACHEDIR=/home/raptor/.cache/matplotlib
Using fontManager instance from /home/raptor/.cache/matplotlib/fontList.json
backend TkAgg version unknown
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="n">se</span> <span class="o">=</span> <span class="n">ScalarEncoder</span><span class="p">(</span><span class="n">minimum</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">maximum</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span><span class="n">vsize</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span><span class="n">spaOnbits</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="k">print</span> <span class="n">se</span><span class="o">.</span><span class="n">info</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&gt; Scalar encoder -----
min-max/range : 0-100/100
buckets,width,n : 180,20,200
resolution : 0.56, 0.0056%
sparsity : 0.10, spa_nbits:20
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="n">sm</span> <span class="o">=</span> <span class="n">iSpatialMapper</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span><span class="mi">1000</span><span class="p">),</span><span class="n">spa</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mf">0.02</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>As I said you don’t need to pretrain it, but to illustrate how it works we need to feed some random data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="k">print</span> <span class="n">sm</span><span class="o">.</span><span class="n">info</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Shape: (200, 1000)
Sparsity: (0.1, 0.02)
ON Bits count : (20,20)
Learn rates : (0.1, 0.01)
Boost learn rate : 0.01 (on:True)
Overlap match % : 0.5
Cell conn. % : 0.85
Permanence thresh : 0.1

None
</pre></div>
</div>
</div>
</div>
<p>We batch train it with 2000 random data points within the encoder value range.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="n">sm</span><span class="o">.</span><span class="n">batch_train</span><span class="p">(</span> <span class="p">[</span> <span class="n">se</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mi">2000</span><span class="p">)</span> <span class="p">]</span> <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="k">print</span> <span class="s2">&quot;Encode 55 &gt; &quot;</span><span class="p">,</span> <span class="n">se</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="mi">55</span><span class="p">)</span>
<span class="k">print</span> <span class="s2">&quot;Normalize 55 &gt; &quot;</span><span class="p">,</span><span class="n">sm</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">se</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="mi">55</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Encode 55 &gt;  99:100:101:102:103:104:105:106:107:108:109:110:111:112:113:114:115:116:117:118
Normalize 55 &gt;  29:75:216:248:254:257:282:334:421:436:440:463:496:582:673:712:810:868:886:954
</pre></div>
</div>
</div>
</div>
<p>The same input should consistenly generate the same output</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="k">print</span> <span class="n">sm</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">se</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="mi">53</span><span class="p">))</span> <span class="o">//</span> <span class="n">sm</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">se</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="mi">53</span><span class="p">))</span>
<span class="k">print</span> <span class="n">sm</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">se</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="mi">55</span><span class="p">))</span> <span class="o">//</span> <span class="n">sm</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">se</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="mi">55</span><span class="p">))</span>
<span class="k">print</span> <span class="n">sm</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">se</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="mi">57</span><span class="p">))</span> <span class="o">//</span> <span class="n">sm</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">se</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="mi">57</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.0
1.0
1.0
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="k">print</span> <span class="n">se</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="mi">55</span><span class="p">)</span> <span class="o">/</span> <span class="n">se</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="mi">57</span><span class="p">)</span>
<span class="k">print</span> <span class="n">sm</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">se</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="mi">55</span><span class="p">))</span> <span class="o">/</span> <span class="n">sm</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">se</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="mi">57</span><span class="p">))</span>
<span class="k">print</span> <span class="n">se</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="mi">55</span><span class="p">)</span> <span class="o">/</span> <span class="n">se</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="mi">53</span><span class="p">)</span>
<span class="k">print</span> <span class="n">sm</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">se</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="mi">55</span><span class="p">))</span> <span class="o">/</span> <span class="n">sm</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">se</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="mi">53</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>17
7
16
8
</pre></div>
</div>
</div>
</div>
<p>… should preserves similarity ratio … the ratio will vary depending on the how encoders and Spatial mapper are configured</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="k">print</span> <span class="n">se</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="mi">55</span><span class="p">)</span> <span class="o">//</span> <span class="n">se</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="mi">40</span><span class="p">)</span>
<span class="k">print</span> <span class="n">sm</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">se</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="mi">55</span><span class="p">))</span> <span class="o">//</span> <span class="n">sm</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">se</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="mi">40</span><span class="p">))</span>
<span class="k">print</span> <span class="n">se</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="mi">55</span><span class="p">)</span> <span class="o">//</span> <span class="n">se</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="mi">70</span><span class="p">)</span>
<span class="k">print</span> <span class="n">sm</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">se</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="mi">55</span><span class="p">))</span> <span class="o">//</span> <span class="n">sm</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">se</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="mi">70</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.0
0.0
0.0
0.0
</pre></div>
</div>
</div>
</div>
<p>at some point the similarity drops to zero.</p>
<div class="section" id="pretrain">
<h2>Pretrain<a class="headerlink" href="#pretrain" title="Permalink to this headline">¶</a></h2>
<p>Earlier we trained SMap with random values. There is method for that.</p>
</div>
<div class="section" id="lexicon-sm-encode-decode">
<h2>Lexicon + SM.encode/decode<a class="headerlink" href="#lexicon-sm-encode-decode" title="Permalink to this headline">¶</a></h2>
<p>In addition you can use as a shortcut SMap own encode method.</p>
<p>Forward/encode : Value =&gt; Encoder =&gt; SMap =&gt; iSDP</p>
<p>this method saves us time by encoding-and-then-mapping the value.</p>
<p>Plus you may need given the iSDP similar to some SM generated vector get back the encoded-symbol i.e. decode()
You have to think about it because this is not trivial operation.
The reason is that we have two processes …</p>
<p>Forward/encode : Value =&gt; Encoder =&gt; SMap =&gt; iSDP
Backward/decode : ~iSDP =&gt; correct iSDP =&gt; Encoder =&gt; Value</p>
<p>Spatial Mapper mapping is not reversable, so we have to build somehow a Map to do that.
Luckily we have Lexicon, where we ca store symbol &lt;=&gt; iSDP map.
So what we can do is every time we encode and SMap a symbol, we store the output-iSDP and the symbol in a lexicon. Later when we decode something that returns iSDP that have to be reversed we use this map.
Of course nothing is free this lexicon takes memory. Also you have to use SMap encode() method which builds this map on the forward pass.</p>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python2",
            path: "./docs/ihtm"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python2'</script>

              </div>
              
              
              <div class='prev-next-bottom'>
                
    <a class='left-prev' id="prev-link" href="encoders.html" title="previous page"><strong>Encoders</strong></a>
    <a class='right-next' id="next-link" href="tm_design.html" title="next page"><strong>TM design</strong></a>

              </div>
              
          </main>
          

      </div>
    </div>
  
  <script src="../../_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  <footer class="footer mt-5 mt-md-0">
  <div class="container">
    
    <div class="footer-item">
      <p class="copyright">
    &copy; Copyright 2021.<br/>
</p>
    </div>
    
    <div class="footer-item">
      <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 3.5.4.<br/>
</p>
    </div>
    
  </div>
</footer>
  </body>
</html>